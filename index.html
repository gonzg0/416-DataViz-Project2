<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
    circle {
        fill: lightblue;
        stroke: black;
    }
</style>

<body onload='init()'>
    <svg width=300 height=300>
    </svg>
    <script>
        async function init() {
            data = d3.csv("https://flunky.github.io/cars2017.csv").then(function (data) {
                avg_mpg = data.map(car => ({
                    city_mpg: Number(car.AverageCityMPG),
                    highway_mpg: Number(car.AverageHighwayMPG),
                    cylinders: car.EngineCylinders,
                }));

                TWO_HUNDRED = 200
                FIFTY = 50
                margin = 50
                var x = d3.scaleLog().base(10).domain([10, 150]).range([0, 200]);
                var y = d3.scaleLog().base(10).domain([10, 150]).range([200, 0]);

                d3.select("svg")
                    .attr("width", TWO_HUNDRED + 2 * FIFTY)
                    .attr("height", TWO_HUNDRED + 2 * FIFTY)
                    .append("g")
                    .attr("transform", "translate(" + margin + "," + margin + ")")
                    .selectAll("circle")
                    .data(avg_mpg)
                    .enter().append("circle")
                    .attr("cx", function (d, i) { return x(d.city_mpg); })
                    .attr("cy", function (d, i) { return y(d.highway_mpg); })
                    .attr("r", function (d, i) { return 2 + Number(d.cylinders); });

                d3.select("svg")
                    .append("g")
                    .attr("transform", "translate(" + 50 + "," + 50 + ")")
                    .call(d3.axisLeft(y).tickValues([10, 20, 50, 100]).tickFormat(d3.format('~s')));

                d3.select("svg")
                    .append("g")
                    .attr("transform", "translate(" + 50 + "," + 250 + ")")
                    .call(d3.axisBottom(x).tickValues([10, 20, 50, 100]).tickFormat(d3.format('~s')));
            });
        }
    </script>
</body>

</html>